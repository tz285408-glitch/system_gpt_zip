<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ØµÙ†Ø§Ù ÙˆØ§Ù„Ø³Ù„Ø© - Ù…Ø­Ø³Ù†</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Tajawal&display=swap');
body{font-family:"Tajawal",sans-serif;direction:rtl;background:#f0f8ff;margin:0;padding:0;}
h2,h3{text-align:center;color:#0d6efd;margin:15px 0;}
.container{width:95%;max-width:1200px;margin:auto;padding:15px;}
input, button{padding:10px;border-radius:8px;border:1px solid #ccc;font-size:16px;}
button{cursor:pointer;background:#0d6efd;color:#fff;border:none;}
button:hover{background:#084298;}

table{width:100%;border-collapse:collapse;margin-top:15px;font-size:14px;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;white-space:normal;overflow-wrap:break-word;}
th{background:#0d6efd;color:#fff;cursor:pointer;}

tr:nth-child(even){background:#e7f1ff;}
.table-container{overflow-x:auto;width:100%;}
#reader,#readerCart{width:100%;margin:10px auto;display:none;}
.autocomplete{border:1px solid #ccc;border-radius:8px;max-height:150px;overflow-y:auto;background:#fff;position:absolute;z-index:1000;width:95%;}
.autocomplete div{padding:8px;cursor:pointer;}
.autocomplete div:hover{background:#d0e4ff;}
#cartMessage{color:#155724;background:#d4edda;padding:10px;margin-top:10px;border-radius:8px;display:none;text-align:center;}



Â Â Â  header {
Â Â Â Â Â  background: #007bff;
Â Â Â Â Â  color: white;
Â Â Â Â Â  padding: 15px;
Â Â Â Â Â  text-align: center;
Â Â Â  }
Â Â Â  nav {
Â Â Â Â Â  background: #e9ecef;
Â Â Â Â Â  display: flex;
Â Â Â Â Â  justify-content: space-around;
Â Â Â Â Â  padding: 10px;
Â Â Â  }
Â Â Â  nav button {
Â Â Â Â Â  padding: 10px 20px;
Â Â Â Â Â  border: none;
Â Â Â Â Â  background: #007bff;
Â Â Â Â Â  color: white;
Â Â Â Â Â  border-radius: 5px;
Â Â Â Â Â  cursor: pointer;
Â Â Â Â Â  transition: background 0.3s;
Â Â Â  }
Â Â Â  nav button:hover {
Â Â Â Â Â  background: #0056b3;
Â Â Â  }
Â Â Â  .content {
Â Â Â Â Â  padding: 20px;
Â Â Â  }
Â Â Â  .form-section {
Â Â Â Â Â  display: none;
Â Â Â Â Â  background: white;
Â Â Â Â Â  padding: 20px;
Â Â Â Â Â  border-radius: 10px;
Â Â Â Â Â  box-shadow: 0 0 5px #ccc;
Â Â Â Â Â  margin-top: 20px;
Â Â Â  }
Â Â Â  label {
Â Â Â Â Â  display: block;
Â Â Â Â Â  margin-top: 10px;
Â Â Â  }
Â Â Â  input, select {
Â Â Â Â Â  width: 100%;
Â Â Â Â Â  padding: 8px;
Â Â Â Â Â  margin-top: 5px;
Â Â Â Â Â  border: 1px solid #ccc;
Â Â Â Â Â  border-radius: 5px;
Â Â Â  }

</style>
</head>
<body>
<nav>
Â  <button onclick="showSection('ahmad2')">Ø¯Ø®ÙˆÙ„ğŸ›¸</button>
Â  </nav>
Â  
<div class="clasarafat">
<section id="ahmad2" class="form-section">

<h2>ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù ğŸ›’ Ø§Ù„Ø³Ù„Ø©</h2>
<nav>
Â  <button onclick="showSection('arafat')">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
</nav>
</section>
</div>

<div class="container">
<section id="arafat" class="form-section">
<!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù -->
<h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>

<!-- Ø£Ø¶Ù Ù‡Ø°Ø§ Ø¯Ø§Ø®Ù„ Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù (#arafat) -->
<div id="reader"></div> <!-- Ù…Ø§Ø³Ø­ QR Ù„Ù„Ø£ØµÙ†Ø§Ù -->

<form id="itemForm">
<div style="margin-top:5px; display:flex; gap:10px; flex-wrap:wrap;">
Â  <div style="flex:1 1 240px; min-width:200px;">
Â Â Â  <label>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù:</label>
Â Â Â  <input type="text" id="itemName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù" required>
Â  </div>

Â  <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
<div id="itemMessage" style="
Â  display:none;
Â  color:#856404;
Â  background:#fff3cd;
Â  padding:15px 20px;
Â  margin:50px auto;
Â  border-radius:10px;
Â  text-align:center;
Â  font-size:24px;Â Â Â Â Â  /* Ø­Ø¬Ù… Ø§Ù„Ø®Ø· */
Â  font-weight:bold;Â Â Â Â  /* Ø¬Ø¹Ù„ Ø§Ù„Ø®Ø· Ø¹Ø±ÙŠØ¶ */
Â  width:fit-content;Â Â Â  /* Ø¹Ø±Ø¶ ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ù†Øµ */
Â  box-shadow: 0 0 10px rgba(0,0,3,0.2); /* ØªØ£Ø«ÙŠØ± Ø®ÙÙŠÙ */
">
</div>
Â  
Â  <div style="flex:1 1 240px; min-width:200px;">
Â Â Â  <label>Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù:</label>
Â Â Â  <div style="display:flex; gap:8px;">
Â Â Â Â Â  <input type="text" id="itemCode" placeholder="Ø§Ù…Ø³Ø­ Ø£Ùˆ Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ù…Ø²" required style="flex:1;">
Â Â Â Â Â  <button type="button" id="scanItemBtn">ğŸ“· Ù…Ø³Ø­ Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù</button>
Â Â Â  </div>
Â  </div>
<div style="display:flex; flex-direction:column; gap:15px;">

Â  <!-- Ø§Ù„ÙˆØ­Ø¯Ø© -->
Â  <div>
Â Â Â  <label>Ø§Ù„ÙˆØ­Ø¯Ø©:</label>
Â Â Â  <input type="text" id="itemUnit" placeholder="Ø§Ù„ÙˆØ­Ø¯Ø© Ù…Ø«Ù„: Ø­Ø¨Ø©ØŒ ÙƒÙŠÙ„ÙˆØŒ Ù„ØªØ±"
Â Â Â Â Â Â Â Â Â Â  required style="width:100%; margin-top:5px;">
Â  </div>

Â  <!-- Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ + Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ -->
Â  <div style="display:flex; gap:10px;">
Â Â Â  
Â Â Â  <div style="flex:1;">
Â Â Â Â Â  <label>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡:</label>
Â Â Â Â Â  <input type="number" id="itemCost" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"
Â Â Â Â Â Â Â Â Â Â Â Â  style="width:100%; margin-top:5px;">
Â Â Â  </div>

Â Â Â  <div style="flex:1;">
Â Â Â Â Â  <label>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹:</label>
Â Â Â Â Â  <input type="number" id="itemPrice" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹"
Â Â Â Â Â Â Â Â Â Â Â Â  style="width:100%; margin-top:5px;">
Â Â Â  </div>

Â  </div>

Â  <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
Â  <div style="display:flex; gap:10px; justify-content:center; margin-top:10px;">

Â Â Â  <button type="submit">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù</button>

Â Â Â  <button type="button" id="cancelItemBtn" style="background:#dc3545;">
Â Â Â Â Â  âŒ Ø¥Ù„ØºØ§Ø¡
Â Â Â  </button>

Â  </div>

</div>
</form>


<div style="margin-top:5px; display:flex; gap:0px; flex-wrap:wrap;">

Â  <select id="sortSelect">
Â Â Â  <option value="">-- ÙØ±Ø² Ø­Ø³Ø¨ --</option>
Â Â Â  <option value="name-asc">Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù ØªØµØ§Ø¹Ø¯ÙŠ</option>
Â Â Â  <option value="name-desc">Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù ØªÙ†Ø§Ø²Ù„ÙŠ</option>
Â Â Â  <option value="code-asc">Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù ØªØµØ§Ø¹Ø¯ÙŠ</option>
Â Â Â  <option value="code-desc">Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù ØªÙ†Ø§Ø²Ù„ÙŠ</option>
Â Â Â  <option value="cost-asc">Ø£Ù‚Ù„ Ø³Ø¹Ø± Ø´Ø±Ø§Ø¡</option>
Â Â Â  <option value="cost-desc">Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± Ø´Ø±Ø§Ø¡</option>
Â Â Â  <option value="price-asc">Ø£Ù‚Ù„ Ø³Ø¹Ø± Ø¨ÙŠØ¹</option>
Â Â Â  <option value="price-desc">Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± Ø¨ÙŠØ¹</option>
Â  </select>
Â <button id="exportExcelBtn">ğŸ“¤ Excel</button> 
Â  <input type="file" id="importExcel" accept=".xlsx,.xls">
Â  <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ ØµÙ†Ù" style="flex:1;">
</div>

<div id="itemsCount" style="text-align:center; font-weight:bold; margin-bottom:10px;">
Â  Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù: 0
</div>

<div class="table-container">
<table id="itemsTable">
Â  <thead>
Â Â Â  <tr>
Â Â Â Â Â  <th>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</th>
Â Â Â Â Â  <th>Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù</th>
Â Â Â Â Â  <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
Â Â Â Â Â  <th>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th>
Â Â Â Â Â  <th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
Â Â Â Â Â  <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
Â Â Â  </tr>
Â  </thead>
Â  <tbody></tbody>
</table>
</div>
<hr>
</section>
<!-- Ø§Ù„Ø³Ù„Ø© -->
</div>
<script>
// ================ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… =================
function showSection(id) {
Â  document.querySelectorAll('.form-section').forEach(s => s.style.display = 'none');
Â  document.getElementById(id).style.display = 'block';
}

// ================= Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù =================
const itemForm = document.getElementById("itemForm");
const itemMessage = document.getElementById("itemMessage");
const itemName = document.getElementById("itemName");
const itemCode = document.getElementById("itemCode");
const itemUnit = document.getElementById("itemUnit");
const itemCost = document.getElementById("itemCost");
const itemPrice = document.getElementById("itemPrice");
const itemsTableBody = document.querySelector("#itemsTable tbody");
let editIndex = null;

function loadItems() {
Â  let items = JSON.parse(localStorage.getItem("itemsList") || "[]");
Â  const sortValue = document.getElementById("sortSelect").value;
Â  if(sortValue){
Â Â Â  const [field,order] = sortValue.split("-");
Â Â Â  items.sort((a,b)=>{
Â Â Â Â Â  if(field==="name"||field==="code") return order==="asc"?a[field].localeCompare(b[field]):b[field].localeCompare(a[field]);
Â Â Â Â Â  return order==="asc"?a[field]-b[field]:b[field]-a[field];
Â Â Â  });
Â  }
Â  itemsTableBody.innerHTML="";
Â  items.forEach((it,i)=>{
Â Â Â  const tr = document.createElement("tr");
Â Â Â  tr.innerHTML = `<td>${it.name}</td><td>${it.code}</td><td>${it.unit}</td><td>${it.cost||''}</td><td>${it.price||''}</td>
Â Â Â Â Â  <td><div style="display:flex; gap:1px;">
Â Â Â Â Â  <button onclick="editItem(${i})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
Â Â Â Â Â  <button onclick="deleteItem(${i})" style="background:#dc3545;">ğŸ—‘ï¸ Ø­Ø°Ù</button>
Â Â Â Â Â  </div></td>`;
Â Â Â  itemsTableBody.appendChild(tr);
Â  });
Â  updateItemsCount();
}

loadItems();

itemForm.addEventListener("submit", e=>{
Â  e.preventDefault();
Â  let items = JSON.parse(localStorage.getItem("itemsList") || "[]");
Â  const nameExists = items.some((it,i)=>it.name===itemName.value && i!==editIndex);
Â  if(nameExists && !confirm("âš ï¸ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹! Ø§Ø³ØªÙ…Ø± Ø£Ù… Ø±Ø¬ÙˆØ¹ØŸ")) return;
Â  const codeExists = items.some((it,i)=>it.code===itemCode.value && i!==editIndex);
Â  if(codeExists){ alert("âš ï¸ Ø§Ù„Ø±Ù…Ø² Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§!"); return; }
Â  const newItem = {name:itemName.value, code:itemCode.value, unit:itemUnit.value, cost:itemCost.value, price:itemPrice.value};
Â  if(editIndex!==null){ items[editIndex] = newItem; editIndex=null; } else { items.push(newItem); }
Â  localStorage.setItem("itemsList", JSON.stringify(items));
Â  itemForm.reset();
Â  loadItems();
});
// ================= Ø¹Ø¯Ø§Ø¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø§ØµÙ†Ø§Ù ÙÙŠØ§Ù„Ø¬Ø¯ÙˆÙ„ =================
function updateItemsCount() {
Â  const items = JSON.parse(localStorage.getItem("itemsList") || "[]");
Â  document.getElementById("itemsCount").textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù: ${items.length}`;
}

window.editItem = i => {
Â  let items = JSON.parse(localStorage.getItem("itemsList") || "[]");
Â  const it = items[i];
Â  showItem(it);
Â  editIndex = i;
};

window.deleteItem = i => {
Â  let items = JSON.parse(localStorage.getItem("itemsList") || "[]");
Â  if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ†ÙØŸ")){
Â Â Â  items.splice(i,1); localStorage.setItem("itemsList", JSON.stringify(items)); loadItems();
Â  }
};

document.getElementById("searchInput").addEventListener("input", ()=>{
Â  const val = document.getElementById("searchInput").value.toLowerCase();
Â  document.querySelectorAll("#itemsTable tbody tr").forEach(r=>r.style.display = r.innerText.toLowerCase().includes(val) ? "" : "none");
});
document.getElementById("sortSelect").addEventListener("change", loadItems);

// ==============ØªØ¹Ø¨ÙŠØ© Ø­Ù‚ÙˆÙ„ Ø§Ù„ØµÙ†Ù Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ùˆ Ø§Ù„Ø­Ø°Ù== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù ================
function showItem(item) {
Â  itemName.value = item.name || "";
Â  itemCode.value = item.code || "";
Â  itemUnit.value = item.unit || "";
Â  itemCost.value = item.cost || "";
Â  itemPrice.value = item.price || "";
Â  editIndex = null;
}

// ================= Ù…Ø§Ø³Ø­ QR Ù„Ù„Ø£ØµÙ†Ø§Ù =================
let isScanning = false;
const reader = document.getElementById("reader");
const scanItemBtn = document.getElementById("scanItemBtn");
const qr = new Html5Qrcode("reader");

scanItemBtn.onclick = async () => {
Â  if (!isScanning) {
Â Â Â  const cams = await Html5Qrcode.getCameras();
Â Â Â  if (!cams.length) return alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒØ§Ù…ÙŠØ±Ø§");
Â Â Â  let cam = cams.find(c => c.label.toLowerCase().includes("back"))?.id || cams[0].id;
Â Â Â  reader.style.display = "block";

Â Â Â  qr.start(cam, { fps: 15, qrbox: { width: 280, height: 160 } },
Â Â Â Â Â  (decoded) => {
Â Â Â Â Â Â Â  const itemsList = JSON.parse(localStorage.getItem("itemsList") || "[]");
Â Â Â Â Â Â Â  const item = itemsList.find(i => i.code === decoded);

Â Â Â Â Â Â Â  if(item){
Â Â Â Â Â Â Â Â Â  showItem(item); // Ø§Ù„ØµÙ†Ù Ù…ÙˆØ¬ÙˆØ¯
Â Â Â Â Â Â Â Â Â  itemMessage.style.display = "block";
Â Â Â Â Â Â Â Â Â  itemMessage.textContent = "âš ï¸ Ø§Ù„ØµÙ†Ù Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!";
Â Â Â Â Â Â Â Â Â  setTimeout(()=>{ itemMessage.style.display = "none"; }, 3000);
Â Â Â Â Â Â Â  } else {
Â Â Â Â Â Â Â Â Â  itemCode.value = decoded; // Ø§Ù„Ø±Ù…Ø² ÙÙ‚Ø·
Â Â Â Â Â Â Â Â Â  itemName.value = "";
Â Â Â Â Â Â Â Â Â  itemUnit.value = "";
Â Â Â Â Â Â Â Â Â  itemCost.value = "";
Â Â Â Â Â Â Â Â Â  itemPrice.value = "";
Â Â Â Â Â Â Â Â Â  itemMessage.style.display = "none";
Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â  reader.style.display = "none";
Â Â Â Â Â Â Â  qr.stop();
Â Â Â Â Â Â Â  isScanning = false;
Â Â Â Â Â Â Â  scanItemBtn.textContent = "ğŸ“· Ù…Ø³Ø­";
Â Â Â Â Â  }
Â Â Â  );

Â Â Â  isScanning = true;
Â Â Â  scanItemBtn.textContent = "â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù";
Â  } else {
Â Â Â  qr.stop();
Â Â Â  reader.style.display = "none";
Â Â Â  scanItemBtn.textContent = "ğŸ“· Ù…Ø³Ø­";
Â Â Â  isScanning = false;
Â  }
};

// ================= Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© =================

// Ø¯Ø§Ù„Ø© ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„
function clearItemFields() {
Â  itemName.value = "";
Â  itemCode.value = "";
Â  itemUnit.value = "";
Â  itemCost.value = "";
Â  itemPrice.value = "";
Â  editIndex = null;
Â  itemMessage.style.display = "none";
}

// Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø¥Ù„ØºØ§Ø¡
cancelItemBtn.addEventListener("click", clearItemFields);
// ================= Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel =================
const importExcelInput = document.getElementById("importExcel");
function getCellValue(obj, keys) {
Â  for (let k of keys) {
Â Â Â  if (obj[k] !== undefined && obj[k] !== null) {
Â Â Â Â Â  return String(obj[k]).trim();
Â Â Â  }
Â  }
Â  return "";
}

importExcelInput.addEventListener("change", function (e) {

Â  const file = e.target.files[0];
Â  if (!file) return;

Â  const reader = new FileReader();

Â  reader.onload = function (evt) {
Â Â Â  let workbook;
Â Â Â  try {
Â Â Â Â Â  workbook = XLSX.read(evt.target.result, { type: "binary" });
Â Â Â  } catch {
Â Â Â Â Â  workbook = XLSX.read(new Uint8Array(evt.target.result), { type: "array" });
Â Â Â  }

Â Â Â  const sheet = workbook.Sheets[workbook.SheetNames[0]];
Â Â Â  if (!sheet) return alert("âŒ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­");

Â Â Â  let rows = XLSX.utils.sheet_to_json(sheet, { defval: "" });
Â Â Â  if (!rows.length) return alert("âŒ Ù…Ù„Ù Excel ÙØ§Ø±Øº");

Â Â Â  // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙÙˆÙ Ø¥Ù„Ù‰ ØµÙŠØºØ© Ù…ÙˆØ­Ø¯Ø©
Â Â Â  const mapped = rows.map(row => {
Â Â Â Â Â  if (Array.isArray(row)) {
Â Â Â Â Â Â Â  return {
Â Â Â Â Â Â Â Â Â  name: String(row[0] || "").trim(),
Â Â Â Â Â Â Â Â Â  code: String(row[1] || "").trim(),
Â Â Â Â Â Â Â Â Â  unit: String(row[2] || "").trim(),
Â Â Â Â Â Â Â Â Â  cost: String(row[3] || "").trim(),
Â Â Â Â Â Â Â Â Â  price: String(row[4] || "").trim(),
Â Â Â Â Â Â Â  };
Â Â Â Â Â  } else {
Â Â Â Â Â Â Â  return {
Â Â Â Â Â Â Â Â Â  name: getCellValue(row, ["name","Ø§Ø³Ù…","Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù"]),
Â Â Â Â Â Â Â Â Â  code: getCellValue(row, ["code","Ø±Ù…Ø²","Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù"]),
Â Â Â Â Â Â Â Â Â  unit: getCellValue(row, ["unit","Ø§Ù„ÙˆØ­Ø¯Ø©"]),
Â Â Â Â Â Â Â Â Â  cost: getCellValue(row, ["cost","Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡"]),
Â Â Â Â Â Â Â Â Â  price: getCellValue(row, ["price","Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹"]),
Â Â Â Â Â Â Â  };
Â Â Â Â Â  }
Â Â Â  });

Â Â Â  let items = JSON.parse(localStorage.getItem("itemsList") || "[]");

Â Â Â  // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ØµÙ†Ø§Ù Ø­Ø³Ø¨ Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù
Â Â Â  mapped.forEach(im => {
Â Â Â Â Â  if (!im.code) return;

Â Â Â Â Â  const code = String(im.code).trim();

Â Â Â Â Â  const idx = items.findIndex(it => String(it.code).trim() === code);

Â Â Â Â Â  const newItem = {
Â Â Â Â Â Â Â  name: im.name,
Â Â Â Â Â Â Â  code: code,
Â Â Â Â Â Â Â  unit: im.unit,
Â Â Â Â Â Â Â  cost: im.cost,
Â Â Â Â Â Â Â  price: im.price
Â Â Â Â Â  };

Â Â Â Â Â  if (idx !== -1) items[idx] = newItem;
Â Â Â Â Â  else items.push(newItem);
Â Â Â  });

Â Â Â  localStorage.setItem("itemsList", JSON.stringify(items));
Â Â Â  loadItems();

Â Â Â  showImportMessage("âœ”ï¸ ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ØµÙ†Ø§Ù");
Â Â Â  importExcelInput.value = "";
Â  };

Â  reader.readAsBinaryString(file);
});

function showImportMessage(text) {
Â  const msg = document.createElement("div");
Â  msg.textContent = text;
Â  msg.style = `
Â Â Â  position: fixed;
Â Â Â  bottom: 20px;
Â Â Â  left: 50%;
Â Â Â  transform: translateX(-50%);
Â Â Â  background: #28a745;
Â Â Â  color: white;
Â Â Â  padding: 12px 20px;
Â Â Â  border-radius: 8px;
Â Â Â  font-size: 16px;
Â Â Â  z-index: 9999;
Â  `;
Â  document.body.appendChild(msg);
Â  setTimeout(() => msg.remove(), 3000);
}

// ================= ØªØµØ¯ÙŠØ± Excel =================
document.getElementById("exportExcelBtn").addEventListener("click", function () {

Â Â Â  // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† LocalStorage
Â Â Â  let items = JSON.parse(localStorage.getItem("itemsList") || "[]");

Â Â Â  if (items.length === 0) {
Â Â Â Â Â Â Â  alert("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ù„ØªØµØ¯ÙŠØ±");
Â Â Â Â Â Â Â  return;
Â Â Â  }

Â Â Â  // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Sheet
Â Â Â  const worksheet = XLSX.utils.json_to_sheet(items);

Â Â Â  // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Excel Ø¬Ø¯ÙŠØ¯
Â Â Â  const workbook = XLSX.utils.book_new();
Â Â Â  XLSX.utils.book_append_sheet(workbook, worksheet, "Items");

Â Â Â  // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù
Â Â Â  XLSX.writeFile(workbook, "items.xlsx");

Â Â Â  // Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
Â Â Â  showExportMessage("âœ”ï¸ ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¥Ù„Ù‰ Excel");
});

function showExportMessage(text) {
Â Â Â  const msg = document.createElement("div");
Â Â Â  msg.textContent = text;
Â Â Â  msg.style = `
Â Â Â Â Â  position: fixed;
Â Â Â Â Â  bottom: 20px;
Â Â Â Â Â  left: 50%;
Â Â Â Â Â  transform: translateX(-50%);
Â Â Â Â Â  background: #007bff;
Â Â Â Â Â  color: white;
Â Â Â Â Â  padding: 12px 20px;
Â Â Â Â Â  border-radius: 8px;
Â Â Â Â Â  font-size: 16px;
Â Â Â Â Â  z-index: 9999;
Â Â Â  `;
Â Â Â  document.body.appendChild(msg);
Â Â Â  setTimeout(() => msg.remove(), 3000);
}
</script>
<!-- Ø±Ø³Ø§Ù„Ø© ØªÙ… Ø­ÙØ¶ Ø§Ù„ØµÙ†Ù Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
<div id="saveMessage" style="
Â  display:none;
Â  position:fixed;
Â  top:50%;
Â  left:50%;
Â  transform:translate(-50%, -50%);
Â  background:#d4edda;
Â  color:#155724;
Â  border:2px solid #28a745;
Â  padding:20px 40px;
Â  font-size:24px;
Â  font-weight:bold;
Â  border-radius:10px;
Â  box-shadow:0 0 15px rgba(0,0,0,0.2);
Â  z-index:9999;
Â  text-align:center;
">
Â  ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…
</div>

<script>
Â  const fields = ["itemName", "itemCode", "itemUnit", "itemCost", "itemPrice"];

Â  // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
Â  fields.forEach(id => {
Â Â Â  const input = document.getElementById(id);
Â Â Â  input.addEventListener("input", () => {
Â Â Â Â Â  if (input.value.trim() !== "") {
Â Â Â Â Â Â Â  input.style.background = "#d4edda";
Â Â Â Â Â Â Â  input.style.border = "2px solid #28a745";
Â Â Â Â Â  } else {
Â Â Â Â Â Â Â  input.style.background = "";
Â Â Â Â Â Â Â  input.style.border = "";
Â Â Â Â Â  }
Â Â Â  });
Â  });

Â  // Ø²Ø± Ø§Ù„Ø¥Ù„ØºØ§Ø¡
Â  const cancelBtn = document.getElementById("cancelItemBtn");
Â  cancelBtn.addEventListener("click", () => {
Â Â Â  fields.forEach(id => {
Â Â Â Â Â  const input = document.getElementById(id);
Â Â Â Â Â  input.value = "";
Â Â Â Â Â  input.style.background = "";
Â Â Â Â Â  input.style.border = "";
Â Â Â  });
Â  });

Â  // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù
Â  const form = document.getElementById("itemForm");
Â  const saveMessage = document.getElementById("saveMessage");

Â  form.addEventListener("submit", function(e) {
Â Â Â  e.preventDefault(); // Ù…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
Â Â Â  
Â Â Â  // Ù‡Ù†Ø§ Ø¶Ø¹ ÙƒÙˆØ¯ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø£ØµÙ„ÙŠ Ø¥Ø°Ø§ Ù…ÙˆØ¬ÙˆØ¯
Â Â Â  // ...

Â Â Â  // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø­Ù‚ÙˆÙ„
Â Â Â  fields.forEach(id => {
Â Â Â Â Â  const input = document.getElementById(id);
Â Â Â Â Â  input.style.background = "";
Â Â Â Â Â  input.style.border = "";
Â Â Â Â Â  input.value = ""; 
Â Â Â  });

Â Â Â  // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸
Â Â Â  saveMessage.style.display = "block";

Â Â Â  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 2.5 Ø«Ø§Ù†ÙŠØ©
Â Â Â  setTimeout(() => {
Â Â Â Â Â  saveMessage.style.display = "none";
Â Â Â  }, 2500);
Â  });
</script>
</body>
</html>

